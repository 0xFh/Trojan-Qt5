image:
  - Visual Studio 2019

install:
  - set QTDIR=C:\Qt\5.14.0\msvc2017_64\bin
  - curl -LO https://slproweb.com/download/Win64OpenSSL-1_1_1d.exe
  - powershell ".\\Win64OpenSSL-1_1_1d.exe /silent /sp- /suppressmsgboxes /DIR='C:\\Libraries1\\OpenSSL-Win64'"
  - git clone https://github.com/TheWanderingCoel/ZBar.git C:\Libraries\ZBar
  - git clone https://github.com/TheWanderingCoel/QREncode.git C:\Libraries\QREncode
  - set PATH=%QTDIR%;%PATH%;
  - git submodule update --init

init:
  - C:\"Program Files (x86)"\"Microsoft Visual Studio"\2019\Community\VC\Auxiliary\Build\vcvarsall.bat x86_amd64

build_script:
  - dir C:\Libraries\boost_1_71_0\
  - mkdir build && cd build
  - qmake ../
  - nmake
  - del *.o *.h *.cpp *.stash *.qrc Makefile
  - zip -r Trojan-Qt5-windows.zip *
  - cd ..

artifacts:
- path: build\Trojan-Qt5-windows.zip
  name: Trojan-Qt5

deploy:
  provider: GitHub
  description: "Trojan-Qt5 Release"
  auth_token:
    secure: uAMRAuhJjhHbPRvsKDUGYBDrrDPhlj2q1zHICgjSo7K2CSmVMxHreSMJYqer4y2k
  artifact: Trojan-Qt5
  draft: false
  prerelease: false
  on:
    branch: master
    APPVEYOR_REPO_TAG: true
